# Superstore Analysis: Complete SQL Query Log

This file contains the complete set of SQL queries used for the Superstore sales analysis. The queries are organized by analytical theme, moving from high-level summaries to detailed, specific investigations.

---

### 1. Overall Performance Analysis

#### 1.1. Total Sales, Profit, and Profit Margin
**Purpose:** To calculate the most fundamental business metrics: total revenue, total profit, and the overall profit margin to gauge the company's profitability.
```sql
SELECT
    SUM(sales) AS total_sales,
    SUM(profit) AS total_profit,
    ROUND((SUM(profit) / SUM(sales)) * 100, 2) AS total_margin_percentage
FROM orders;


1.2. Average Sales Per Customer
Purpose: To understand the average revenue generated by each unique customer, helping to establish a baseline for customer value.
Generated sql
SELECT
    ROUND(AVG(total_sales_per_customer), 2) AS avg_sales_per_customer
FROM (
    SELECT
        customer_id,
        SUM(sales) AS total_sales_per_customer
    FROM orders
    GROUP BY customer_id
) AS customer_sales;



2. Geographic Analysis

2.1. Top Performing Locations by Sales and Profit
Purpose: To identify the most lucrative markets (country, region, state) to focus marketing and logistical efforts.
SELECT
    c.country,
    c.region,
    c.state,
    SUM(o.sales) AS total_sales,
    SUM(o.profit) AS total_profit
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
GROUP BY c.country, c.region, c.state
ORDER BY total_sales DESC
LIMIT 10;


2.2. Customer Distribution by Country
Purpose: To understand the geographic distribution of the customer base, identifying where the most customers are located.
SELECT
    country,
    COUNT(DISTINCT customer_id) AS customer_count
FROM customers
GROUP BY country
ORDER BY customer_count DESC;


3. Customer Analysis
3.1. Top 10 Most Valuable Customers
Purpose: To identify high-value customers who could be targeted for loyalty programs and personalized marketing campaigns. This query uses a Common Table Expression (CTE) for clarity.
WITH customer_performance AS (
    SELECT
        c.customer_id,
        c.customer_name,
        SUM(o.sales) AS total_sales,
        SUM(o.profit) AS total_profit
    FROM orders o
    JOIN customers c ON o.customer_id = c.customer_id
    GROUP BY c.customer_id, c.customer_name
)
SELECT
    customer_name,
    total_sales,
    total_profit
FROM customer_performance
ORDER BY total_sales DESC
LIMIT 10;


3.2. Customer Segmentation by Sales
Purpose: To segment customers into 'High', 'Medium', and 'Low' value tiers based on their total spending. This is crucial for targeted marketing.
SELECT
    c.customer_id,
    SUM(o.sales) AS total_sales,
    CASE
        WHEN SUM(o.sales) > 5000 THEN 'High Value'
        WHEN SUM(o.sales) BETWEEN 1000 AND 5000 THEN 'Medium Value'
        ELSE 'Low Value'
    END AS customer_segment
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id
ORDER BY total_sales DESC;


4. Product Performance Analysis
4.1. Sales and Profit by Product Category & Sub-Category
Purpose: To determine which product lines are the most and least profitable, informing inventory, marketing, and pricing strategies.
SELECT
    p.category,
    p.sub_category,
    SUM(o.sales) AS total_sales,
    SUM(o.profit) AS total_profit
FROM orders o
JOIN products p ON o.product_id = p.product_id
GROUP BY p.category, p.sub_category
ORDER BY total_profit DESC;


4.2. Top 10 Best-Selling Products
Purpose: To identify the individual products that generate the most revenue for the company.
SELECT
    p.product_name,
    SUM(o.sales) AS total_sales,
    SUM(o.quantity) AS total_quantity_sold
FROM products p
JOIN orders o ON p.product_id = o.product_id
GROUP BY p.product_name
ORDER BY total_sales DESC
LIMIT 10;


4.3. High-Selling but Low-Profitability Products
Purpose: A crucial query to uncover "problem products" that sell in high volume but erode profit margins, suggesting a need for repricing, cost reduction, or discontinuation.
SELECT
    p.product_name,
    p.category,
    SUM(o.sales) AS total_sales,
    SUM(o.profit) AS total_profit,
    ROUND((SUM(o.profit) / SUM(o.sales)) * 100, 2) AS profit_margin
FROM orders o
JOIN products p ON o.product_id = p.product_id
GROUP BY p.product_name, p.category
HAVING SUM(sales) > 5000 AND (SUM(profit) / SUM(sales)) < 0.05
ORDER BY profit_margin ASC;


5. Operational Analysis

5.1. Impact of Discounts on Profitability
Purpose: To evaluate the effectiveness of the discount strategy by showing the trade-off between stimulating sales and eroding profit margins.
SELECT
    CASE
        WHEN discount = 0 THEN 'No Discount'
        WHEN discount <= 0.2 THEN 'Low Discount (1-20%)'
        ELSE 'High Discount (20%+)'
    END AS discount_level,
    COUNT(order_id) AS number_of_orders,
    ROUND(AVG(profit), 2) AS average_profit,
    ROUND(SUM(profit), 2) AS total_profit
FROM orders
GROUP BY discount_level
ORDER BY average_profit DESC;


5.2. Most Used Shipping Modes
Purpose: To identify the most popular shipping methods, which helps in negotiating with carriers and managing logistics.
SELECT
    ship_mode,
    COUNT(*) AS usage_count
FROM orders
GROUP BY ship_mode
ORDER BY usage_count DESC;


5.3. Average Shipping Time by Region
Purpose: To analyze logistical efficiency across different regions, identifying potential bottlenecks or areas for improvement in the supply chain.
SELECT
    c.region,
    ROUND(AVG(o.ship_date - o.order_date), 2) AS avg_shipping_days
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
GROUP BY c.region
ORDER BY avg_shipping_days DESC;
